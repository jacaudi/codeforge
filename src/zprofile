# Inside tmux: show MOTD once per session
if [ -n "$TMUX" ]; then
    if ! tmux show-environment CODEFORGE_MOTD 2>/dev/null | grep -q '=1'; then
        cat /etc/motd
        tmux set-environment CODEFORGE_MOTD 1
    fi
elif [ -n "$SSH_CONNECTION" ]; then
    # SSH login: auto-attach to tmux
    if tmux has-session -t main 2>/dev/null; then
        printf '\n  Existing tmux session detected.\n\n'
        printf '  [1] Attach to shared session\n'
        printf '  [2] Start new session\n'
        printf '  [q] Skip (plain shell)\n\n'
        printf '  > '
        read -r choice
        case $choice in
            1) exec tmux attach-session -t main ;;
            2) exec tmux new-session ;;
            q|Q) ;;
            *) ;;
        esac
    else
        exec tmux new-session -s main
    fi
fi
